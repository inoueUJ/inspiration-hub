# Copilot å®Ÿè£…ãƒ«ãƒ¼ãƒ«ãƒ»ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€GitHub Copilotï¼ˆãŠã‚ˆã³é–‹ç™ºè€…ï¼‰ãŒã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»å®Ÿè£…ã™ã‚‹éš›ã«å®ˆã‚‹ã¹ããƒ«ãƒ¼ãƒ«ã¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’æ˜è¨˜ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ¯ å®Ÿè£…ã®åŸå‰‡

### 1. å‹å®‰å…¨æ€§ã®æœ€é‡è¦–
- **å¸¸ã« TypeScript ã‚’ä½¿ç”¨** - `any` ã¯ç¦æ­¢
- **Drizzle ORM ã®å‹æ¨è«–ã‚’æ´»ç”¨** - `$inferSelect` / `$inferInsert`
- **Zod ã‚¹ã‚­ãƒ¼ãƒã§å…¥å‡ºåŠ›ã‚’æ¤œè¨¼** - API ãƒªã‚¯ã‚¨ã‚¹ãƒˆ / ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ãƒã‚§ãƒƒã‚¯

### 2. é–¢å¿ƒã®åˆ†é›¢
- **DB ãƒ­ã‚¸ãƒƒã‚¯** â†’ `src/lib/db/`
- **API ãƒ­ã‚¸ãƒƒã‚¯** â†’ `src/lib/api/`
- **èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯** â†’ `src/lib/auth/`

### 3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã®éµå®ˆ
- **API çµŒç”±ã®ã¿** - ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ DB ã«ç›´æ¥æ¥ç¶šã—ãªã„
- **ç’°å¢ƒå¤‰æ•°ã®åˆ†é›¢** - CLOUDFLARE_* ç³»ã¯ã‚µãƒ¼ãƒãƒ¼å´ã®ã¿

### 4. ã‚·ãƒ³ãƒ—ãƒ« over è¤‡é›‘
- **æœªä½¿ç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å°å…¥ã¯é¿ã‘ã‚‹**
- **Next.js çµ„ã¿è¾¼ã¿æ©Ÿèƒ½ã‚’æ´»ç”¨**

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆãƒ»å‘½åè¦å‰‡

### ãƒ•ã‚¡ã‚¤ãƒ«å
```
route.ts (API)
Button.tsx (ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
formatDate.ts (ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£)
schema.ts (DB ã‚¹ã‚­ãƒ¼ãƒ)
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåï¼ˆkebab-caseï¼‰
```
src/app/api/daily-quotes/
src/lib/db/
src/lib/api/
```

---

## ğŸ’» ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### TypeScript

#### å‹å®šç¾©
```typescript
type CreateQuoteRequest = {
  text: string;
  textJa?: string;
  authorId: number;
  subcategoryId: number;
};
```

#### Drizzle ORM
```typescript
import { db } from "@/lib/db/client";
import { quotes } from "@/lib/db/schema";

const allQuotes = await db
  .select()
  .from(quotes)
  .where(isNull(quotes.deletedAt));
```

#### Zod ã‚¹ã‚­ãƒ¼ãƒ
```typescript
import { z } from "zod";

export const createQuoteSchema = z.object({
  text: z.string().min(1),
  authorId: z.number().int().positive(),
  subcategoryId: z.number().int().positive(),
});
```

### API Route Handlers

#### åŸºæœ¬æ§‹æˆ
```typescript
import { NextRequest, NextResponse } from "next/server";
import { db } from "@/lib/db/client";
import { successResponse, errorResponse } from "@/lib/api/response";

export async function GET(request: NextRequest) {
  try {
    const data = await db.select().from(quotes);
    return successResponse(data);
  } catch (error) {
    console.error("Error:", error);
    return errorResponse("INTERNAL_ERROR", "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
  }
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const validated = createQuoteSchema.parse(body);
    
    const [newQuote] = await db
      .insert(quotes)
      .values(validated)
      .returning();
    
    return successResponse(newQuote, 201);
  } catch (error) {
    if (error instanceof z.ZodError) {
      return errorResponse("VALIDATION_ERROR", "ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼");
    }
    return errorResponse("INTERNAL_ERROR", "ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ");
  }
}
```

---

## ğŸ—„ï¸ DB æ“ä½œã®ãƒ‘ã‚¿ãƒ¼ãƒ³

### CREATE
```typescript
const [newQuote] = await db
  .insert(quotes)
  .values({ text: "...", authorId: 1 })
  .returning();
```

### READ
```typescript
// å…¨ä»¶ï¼ˆå‰Šé™¤æ¸ˆã¿é™¤å¤–ï¼‰
const allQuotes = await db
  .select()
  .from(quotes)
  .where(isNull(quotes.deletedAt));

// å˜ä»¶
const [quote] = await db
  .select()
  .from(quotes)
  .where(eq(quotes.id, id));
```

### UPDATE
```typescript
const [updated] = await db
  .update(quotes)
  .set({ text: "æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆ", updatedAt: new Date() })
  .where(eq(quotes.id, id))
  .returning();
```

### DELETE (Soft Delete)
```typescript
const [deleted] = await db
  .update(quotes)
  .set({ deletedAt: new Date() })
  .where(eq(quotes.id, id))
  .returning();
```

---

## ğŸ” èªè¨¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³

```typescript
export async function checkSession(request: NextRequest) {
  const cookieStore = await cookies();
  const token = cookieStore.get("session_token")?.value;
  
  if (!token) return null;
  
  const [session] = await db
    .select()
    .from(sessions)
    .where(eq(sessions.token, token));
  
  if (!session || session.expiresAt < new Date()) return null;
  
  return session;
}
```

---

## âœ… å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] **å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** - Zod ã‚¹ã‚­ãƒ¼ãƒã§æ¤œè¨¼
- [ ] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** - try-catch ã§é©åˆ‡ã«å‡¦ç†
- [ ] **èªè¨¼ç¢ºèª** - POST/PUT/DELETE ã¯èªè¨¼å¿…é ˆ
- [ ] **Soft Delete** - DELETE ã¯ deletedAt ã«æ—¥æ™‚ã‚’è¨­å®š
- [ ] **å‹å®‰å…¨** - any ã‚’ä½¿ã‚ãªã„
- [ ] **ãƒ­ã‚°å‡ºåŠ›** - console.error ã§ã‚¨ãƒ©ãƒ¼è¨˜éŒ²
- [ ] **ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼** - successResponse / errorResponse ã‚’ä½¿ç”¨

---

## ğŸš¨ ç¦æ­¢äº‹é …

```typescript
// âŒ any ã®ä½¿ç”¨
const data: any = await fetch(...);

// âŒ ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ DB ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
// â†’ API ã‚’çµŒç”±ã™ã‚‹

// âŒ ç’°å¢ƒå¤‰æ•°ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ä½¿ç”¨
process.env.CLOUDFLARE_DATABASE_ID

// âŒ æœªå‡¦ç†ä¾‹å¤–
try {
  // å‡¦ç†
} catch (error) {
  // ä½•ã‚‚ã—ãªã„
}
```

---

**æœ€çµ‚æ›´æ–°**: 2025-11-10
